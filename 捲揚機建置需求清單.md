# 捲揚機移動系統建置需求清單（手動控制版本）

## 📋 使用說明
請填寫以下所有項目，這些資訊將用於建立捲揚機控制程式。

**⚠️ 重要說明：**
- 此版本為**手動控制模式**，不包含自動化功能
- **不與** `realsence_auto_hit.py`（視覺辨識）整合
- **不與** `bottom_hit.ino`（敲擊機構）整合
- 主要功能：鍵盤控制移動（w/s/a/d）和直接座標輸入
- 未來如需自動化，可在此基礎上擴展

**✅ 已確認的資訊：**
- Arduino 腳位定義（與 110 專案一致）：
  - L1 步進脈衝：GPIO 16
  - L1 方向：GPIO 17
  - L2 步進脈衝：GPIO 26
  - L2 方向：GPIO 25
  - LED：GPIO 2
- 步進馬達參數：
  - 每轉步數：3200 步（200 * 16，1/16 微步）
- 通訊方式：WiFi UDP（端口 2024）

**📝 待填寫的資訊：**
- 捲揚機幾何參數（兩個捲揚機距離 w）
- 每轉繩長
- 座標系統設定（原點、範圍、初始位置）
- WiFi 連線資訊（SSID、密碼、Agent IP）
- **牛耕式掃描模式參數**（掃描區域、行數、列數、間距等）

---

## 1. 硬體參數（必須提供）

### 1.1 捲揚機幾何參數
```
□ 兩個捲揚機（卷軸）之間的距離 w = ______ mm（或 cm）
  （測量兩個捲揚機中心點的水平距離）
  （注意：110 專案使用 79 cm，請根據您的實際情況填寫）
```

### 1.2 步進馬達參數
```
✅ 步進馬達每轉步數 = 200 * 16 = 3200 步（已確認，與 110 專案一致）
✅ 微步設定 = 1/16（已確認，與 110 專案一致）

□ 捲揚機每轉一圈的繩長 = ______ mm（或 cm）
  （實測：轉一圈，測量繩子收放長度）
  （注意：110 專案使用 7.5 cm，請根據您的實際情況填寫）
  
□ X 軸修正係數 = ______
  （初始設 1.0，如果左右移動不對稱再調整）
  （注意：110 專案使用 2.0，可作為參考）
```

### 1.3 Arduino 腳位定義（已確認，與 110 專案一致）
```
✅ L1 捲揚機（左側）步進脈衝腳 (xstepPin) = GPIO 16
✅ L1 捲揚機（左側）方向腳 (xdirPin) = GPIO 17
✅ L2 捲揚機（右側）步進脈衝腳 (ystepPin) = GPIO 26
✅ L2 捲揚機（右側）方向腳 (ydirPin) = GPIO 25
✅ LED 指示燈腳位 (LED_PIN) = GPIO 2
```

### 1.4 限位開關（如果有）
```
□ X 軸限位開關腳位 = GPIO ______（可選）
□ Y 軸限位開關腳位 = GPIO ______（可選）
□ 限位開關類型 = □ 常開 (NO)  □ 常閉 (NC)
```

---

## 2. 座標系統設定（必須提供）

### 2.1 座標系統定義
```
□ 座標原點位置 = ______
  （說明：例如左下角、中心點等，請描述原點位置）
  
□ 座標單位 = □ mm（毫米）  □ cm（公分）
```

### 2.2 初始位置設定
```
□ 捲揚機初始 X 座標 = ______
  （系統啟動時的起始 X 座標）
  
□ 捲揚機初始 Y 座標 = ______
  （系統啟動時的起始 Y 座標）
```

### 2.3 工作範圍限制
```
□ X 軸最小值 = ______
□ X 軸最大值 = ______
□ Y 軸最小值 = ______
□ Y 軸最大值 = ______
```

---

## 3. ROS2 通訊設定（手動控制模式 + 牛耕式掃描）

### 3.1 訂閱的 Topic（手動控制）
```
□ 鍵盤輸入 Topic 名稱 = "/keyboard_input"（建議）
  Topic 類型：std_msgs/String
  控制命令：
    - "w" 或 "t" = 向上移動（Y 軸增加）
    - "s" 或 "g" = 向下移動（Y 軸減少）
    - "a" = 向左移動（X 軸減少）
    - "d" = 向右移動（X 軸增加）
    - 可連續輸入，例如："wwww", "aadd"
  
□ 直接座標輸入 Topic 名稱 = "/target_coordinates"（可選）
  Topic 類型：std_msgs/String
  座標格式："x,y"（例如："100.5,50.2"）
  功能：直接移動到指定座標

□ 啟動牛耕式掃描 Topic 名稱 = "/start_scan"（建議）
  Topic 類型：std_msgs/String
  命令格式："start" 或 JSON 格式的掃描參數
  功能：啟動自動牛耕式掃描模式
```

### 3.2 牛耕式掃描模式設定
```
□ 掃描區域起始 X 座標 = ______
  （掃描區域的左下角 X 座標）

□ 掃描區域起始 Y 座標 = ______
  （掃描區域的左下角 Y 座標）

□ 掃描區域寬度 = ______
  （X 軸方向的掃描範圍）

□ 掃描區域高度 = ______
  （Y 軸方向的掃描範圍）

□ 掃描行數 = ______
  （垂直方向要掃描幾行，例如：3 行）

□ 掃描列數 = ______
  （水平方向要掃描幾列，例如：每行 10 個點）

□ 掃描點間距（X 方向）= ______
  （同一行中，相鄰掃描點之間的 X 軸距離）

□ 掃描行間距（Y 方向）= ______
  （相鄰兩行之間的 Y 軸距離）

□ 掃描移動速度 = ______
  （移動到每個掃描點的速度，可選）

移動模式說明：
  - 第 1 行：從左到右移動（X 增加）
  - 第 2 行：從右到左移動（X 減少）
  - 第 3 行：從左到右移動（X 增加）
  - 以此類推（蛇形/牛耕式模式）
```

### 3.2 發布的 Topic（狀態回報）
```
□ 當前位置 Topic 名稱 = "/top_base_coordinates"（建議）
  Topic 類型：std_msgs/String
  發布頻率：每秒一次（或移動完成後）
  格式範例："Current coordinates: (100.50, 50.20)"
  
□ 狀態回報 Topic 名稱 = "/top_base_status"（可選）
  Topic 類型：std_msgs/String
  狀態值：□ "ready"  □ "moving"  □ "error"
```

### 3.3 節點名稱
```
□ ROS2 節點名稱 = "top_base_move_node"（建議）
```

---

## 4. 通訊方式設定（必須提供）

### 4.1 Micro-ROS 傳輸方式（已確認：WiFi UDP）
```
✅ 通訊方式：WiFi UDP

□ WiFi SSID：________________
  （請填寫您的 WiFi 網路名稱）
  
□ WiFi 密碼：________________
  （請填寫您的 WiFi 密碼）
  
□ Agent IP 地址：________________
  （請填寫運行 MicroXRCEAgent 的電腦 IP 地址）
  
✅ Agent 端口：2024（已確認，與 110 專案一致）

✅ 啟動命令：MicroXRCEAgent udp4 --port 2024 -v6
  （在電腦端執行此命令啟動 Agent）

Arduino 端設定：
  set_microros_wifi_transports("WiFi_SSID", "WiFi_密碼", "Agent_IP", 2024);
```

---

## 5. 移動控制參數（建議設定）

### 5.1 移動速度控制
```
□ 移動間隔時間 = ______ 毫秒（建議：100 ms）
□ 脈衝延遲時間 = ______ 微秒（建議：500 微秒）
□ 移動穩定等待時間 = ______ 秒（建議：0.25 秒）
```

### 5.2 命令佇列設定
```
□ 命令佇列大小 = ______（建議：100）
```

---

## 6. 座標轉換邏輯

### 6.1 座標 → 繩長計算
```
L1 繩索長度（左側捲揚機到目標點）：
  L1 = √(local_x² + local_y²)

L2 繩索長度（右側捲揚機到目標點）：
  L2 = √(local_x² + local_y² + w² - 2×w×local_x)
  或
  L2 = √((local_x - w)² + local_y²)
```

---

## 7. 測試項目清單

### 7.1 硬體測試
```
□ 步進馬達可以正常轉動
□ 兩個捲揚機可以獨立控制
□ 限位開關（如有）可以正常觸發
□ LED 指示燈（如有）可以正常點亮
```

### 7.2 通訊測試
```
□ Micro-ROS 可以成功連線
□ 可以接收 /keyboard_input 訊息
□ 可以接收 /target_coordinates 訊息（如有）
□ 可以發布位置和狀態訊息
```

### 7.3 移動測試
```
□ 鍵盤控制（w/s/a/d）可以正常移動
□ 直接座標輸入可以移動到指定位置
□ 移動精度符合要求
□ 移動速度適中
□ 座標範圍檢查正常運作
```

### 7.4 牛耕式掃描測試
```
□ 可以正確啟動掃描模式
□ 掃描路徑符合預期（奇數行左到右，偶數行右到左）
□ 可以正確計算所有掃描點座標
□ 移動順序正確（不跳過任何點）
□ 掃描完成後可以正確返回起始點
□ 掃描過程中可以暫停/繼續
□ 掃描過程中可以取消掃描
```

---

## 8. 控制功能說明

### 8.1 鍵盤控制模式
```
功能：透過 ROS2 topic 接收鍵盤輸入命令
Topic：/keyboard_input
命令：
  - "w" 或 "t"：向上移動（Y 軸增加）
  - "s" 或 "g"：向下移動（Y 軸減少）
  - "a"：向左移動（X 軸減少）
  - "d"：向右移動（X 軸增加）
  - 可連續輸入多個命令，例如："wwww" = 向上移動 4 次
```

### 8.2 直接座標輸入模式（可選）
```
功能：直接輸入目標座標進行移動
Topic：/target_coordinates
格式："x,y"（例如："100.5,50.2"）
說明：系統會計算繩長並移動到指定座標
```

### 8.3 牛耕式掃描模式（新增）
```
功能：自動執行系統性掃描，按照「牛耕式」或「蛇形」路徑移動

移動模式示意圖：
  第 1 行：→ → → → → （從左到右）
  第 2 行：← ← ← ← ← （從右到左）
  第 3 行：→ → → → → （從左到右）
  ...

啟動方式：
  - 透過 /start_scan topic 發送啟動命令
  - 可指定掃描參數（起始點、範圍、行數、列數等）

掃描流程：
  1. 移動到掃描區域起始點（左下角）
  2. 按照設定的行數和列數，依序移動到每個掃描點
  3. 奇數行：從左到右移動
  4. 偶數行：從右到左移動（反向）
  5. 完成所有掃描點後，返回起始點或指定位置

應用場景：
  - 系統性檢測或掃描
  - 覆蓋整個工作區域
  - 自動化數據採集
```

---

## 9. 注意事項

### 9.1 座標格式
- 直接座標輸入格式：`"x,y"`（例如："100.5,50.2"）
- 座標單位：根據您填寫的單位（mm 或 cm）
- 需要解析逗號分隔的座標值

### 9.2 座標範圍檢查
- 移動前需檢查座標是否在允許範圍內
- 超出範圍時，應拒絕移動並記錄錯誤

### 9.3 移動控制
- 鍵盤控制：每次命令移動固定距離（例如：1 單位）
- 直接座標：移動到指定座標位置
- 移動完成後，更新當前位置並發布狀態

### 9.4 錯誤處理
- 座標超出範圍時，應拒絕移動並記錄錯誤
- 移動超時時，應停止移動並報告錯誤狀態
- 通訊中斷時，應保持當前狀態並等待重連

---

## 10. 填寫完成檢查

請確認以下項目都已填寫：

- [ ] 1.1 捲揚機幾何參數（兩個捲揚機距離 w）
- [ ] 1.2 步進馬達參數（每轉繩長、X 軸修正係數）
- [x] 1.3 Arduino 腳位定義（✅ 已確認，與 110 專案一致）
- [ ] 2.1 座標系統定義（原點位置、單位）
- [ ] 2.2 初始位置設定
- [ ] 2.3 工作範圍限制
- [x] 4.1 Micro-ROS 傳輸方式（✅ 已確認：WiFi UDP，需填寫 SSID、密碼、IP）
- [ ] 5.1 移動速度控制（可選，有預設值）
- [ ] 3.2 牛耕式掃描模式設定（掃描區域、行數、列數、間距）

---

## 11. 後續步驟

填寫完成後，將使用此清單建立：
1. Arduino 捲揚機控制程式（`top_base_move.ino`）- **手動控制版本**
2. 啟動腳本更新（`start_system.sh`）- 加入 MicroXRCEAgent 啟動命令
3. 測試程式和說明文件

**注意：** 此版本為手動控制模式，不包含與視覺辨識和敲擊機構的自動化整合。
未來如需自動化功能，可在此基礎上擴展。

---

**建立日期：** 2025-11-23  
**專案路徑：** `/home/richlin0308/114`  
**參考檔案：** `110/Arduino_IDE/top_base_upd_test2/top_base_upd_test2.ino`

